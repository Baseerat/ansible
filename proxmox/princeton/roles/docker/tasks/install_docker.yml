---

- name: Ensure repository key is installed
  apt_key:
    id: "{{ docker_apt_key_id }}"
    keyserver: "{{ docker_apt_keyserver }}"
    state: present

- name: Ensure docker registry is available
  # For Ubuntu 14.04 LTS, use this repository:
  apt_repository:
    repo: "{{ docker_apt_repo_14_04 }}"
    update_cache: yes
    state: present
#  # For Ubuntu 16.04 LTS, use this repo instead:
#  apt_repository:
#    repo: "{{ docker_apt_repo_16_04 }}"
#    update_cache: yes
#    state: present

## For Ubuntu Trusty, Vivid, and Wily, itâ€™s recommended to install the linux-image-
## extra kernel package. The linux-image-extra package allows you use the aufs
## storage driver.
## https://docs.docker.com/engine/userguide/storagedriver/aufs-driver/
## had to run manually
#- name: allow use of aufs storage driver
# shell: apt-get install linux-image-extra-$(uname -r)

- name: Ensure docker and dependencies are installed
  apt:
    name: docker-engine

## Uncomment the following to enable insecure registries with Docker
#- name: Ensure docker can use insecure registries in 10.11.0.0/16
#  lineinfile: "dest=/etc/default/docker regexp=^DOCKER_OPTS line=DOCKER_OPTS='--insecure-registry 10.11.0.0/16'"

- name: Add user {{ ansible_user }} to docker group
  user:
    name: "{{ ansible_user }}"
    groups: docker
    append: yes

- name: Restart docker service
  service:
    name: docker
    state: restarted

- name: Get docker compose
  get_url:
    url: "{{ docker_compose_url }}"
    dest: /usr/local/bin/docker-compose
    mode: 0755

#- debug:
#  msg: "{{inventory_hostname}}"